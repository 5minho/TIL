### 버퍼 캐쉬

커널이 상대적으로 저속인 디스크 전송속도 때문에 디스크 접근 횟수를 최소화 하기 위해 최근에 사용되었던 디스크 블럭들의 데이터를 저장해두는 버퍼 풀(pool)을 말한다.

하나의 버퍼는 메모리 배열 + 버퍼 헤더로 구성된다.
버퍼 하나의 데이터(메모리 배열)는 파일 시스템 상의 하나의 논리적 디스크 블럭이랑 일대일 대응이다.

버퍼헤더는 해당 버퍼를 식별하는 역할을 하고 다음의 필드들을 갖는다.

* 장치 번호 (논리적인 파일 시스템 번호)
* 블럭 번호 (디스크상에 있는 데이터의 블럭)
* 메모리 배열을 가리키는 포인터
* 버퍼의 상태 (lock, free, delayed-write, 쓰고 있거나 읽어 오고있음, 자유화 되기 기다림)
* 해쉬 큐 상의 이전, 다음 포인터
* 자유 리스트상의 이전, 다음 포인터

자유 리스트는 LRU 알고리즘에 따라서 유지되는 자유(free) 버퍼들의 양방향 원형 연결 리스트 이다. 커널이 자유 버퍼가 필요하면 자유 리스트의 앞에서 자유 버퍼를 하나 취하고 커널이 버퍼 풀로 자유 리스트를 반납할때, 오류가 없다면 해당 버퍼를 자유 리스트의 끝에 삽입한다. 따라서 자유 리스트 앞에 있는 버퍼들은 뒤에 있는 버퍼들에 비해 최근에 사용되지 않은 것이다.

해쉬 큐는 커널이 디스크 블럭을 접근할 때, 적절한 장치-블럭 번호 조합을 가지고 있는 버퍼를 빨리 찾기 위해 만들어 놓은 큐이다.

모든 버퍼는 해쉬 큐에 존재하고, 자유 리스트에는 있을 수도 없을 수도 있다.

### 커널은 어떠한 방식으로 특정 디스크 블럭을 찾는가

커널이 특정 디스크 블럭에 있는 데이터를 읽으려고 할 때 일단 버퍼 풀에 그 데이터가 있는지 검사하고, 없다면 그 블럭에 자유 버퍼를 할당한다.

커널이 특정 디스크 블럭에 데이터를 쓰려고 할 때, 그 블럭이 버퍼 풀에 있는지 검사하고, 없다면 그 블럭에 자유 버퍼를 할당한다.

자유 버퍼를 할당하는 알고리즘 - getblk
버퍼를 방출하는 알고리즘 - brelse
