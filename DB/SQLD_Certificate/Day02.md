### Day 02

http://www.gurubee.net/lecture/2359 에서 성능 데이터 모델링에 대해서 공부

#### 성능 데이터 모델링의 목적
성능향상

#### 무엇을 건드는가
정규화, 반정규화, 테이블 통합, 테이블 분할, 조인 구조, PK, FK 등등

#### 언제하면 좋은가
사전에 할 수록 좋다 (비용 덜든다)
분석 / 설계 단계에서 하면 좋다
비즈니스 처리에 핵심 트랜잭션 성능, 적절한 데이터 모델 구조를 초기에 테스트 해보자

#### 다음과 같은 프로세스로 성능 데이터 모델링을 하면 좋다.
* 일단 정규화를 정확하게 수행
* DB 용량 산정
* DB에 발생되는 트랜잭션 유형 파악
* 용량과 트랜잭션 유형에 따라 반정규화 수행
* 이력 모델의 조정, PK/FK 조정, 슈퍼타입 / 서브타입 조정등을 수행
* 성능관점에서 데이터 모델 검즘

#### 정규화와 성능
일단 정규화의 종류와 내용은
* 1차 정규화 : 복수의 속성값을 갖는 속성을 분리
* 2차 정규화 : 부분 종속 속성 분리
* 3차 정규화 : 이전 종속 속성 분리
* 보이스-코드 정규화 : 다수의 주식별자 분리
* 4차 정규화 : 다가 종속 속성 분리
* 5차 정규화 : 결합 종속일 경우는 두 개 이상의 N개로 분리

#### 정규화를 하면 성능이 좋아질까?
정규화를 하는 것 자체가 데이터에 대한 중복성을 제거해주고 데이터가 관심사별로 모여있게 하는것 이기 때문에 일반적으로 성능이 좋아짐. 단 엔티티(테이블)이 계속 발생하고 하다보면 그에 따른 조인연산이 발생하므로 조회 연산의 성능이 저하 되기도 함. 이런 부분은 사례별로 유의하여 반정규화를 적용하는 전략 필요. (입력, 수정, 삭제할 때는 반정규화된 테이블 보다 성능이 좋음)

#### 반정규화와 성능
반정규화는 정규화된 엔티티, 속성, 관계를 시스템의 성능향상 및 개발과 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링 기법이다.

#### 언제 반정규화를 할까
디스크 I/O 량이 많아서 조회시 성능이 저하되거나, 테이블끼리의 경로가 너무 멀어(분산 서버) 조인으로 인한 성능저하가 예상되거나, 컬럼을 계산하여 읽을 때 성능이 저하될 것이 예상되면 반정규화를 한다. 

설계 단계에서 한다.

#### 반정규화를 하기 전에...
반정규화의 대상에 대해 다른 방법으로 처리할 수 있는지 검토한다.
* View 의 사용 검토
* 클러스터링, 인덱스 조정 검토
* 파티셔닝 검토
* 어플리케이션에서의 로직 검토

#### 반정규화의 대상
테이블, 속성, 관계를 추가 / 분할 / 제거 

#### 테이블 반정규화
| 기법 | 기법 | 내용 |
| :----: | :----: | :----: | 
| 테이블 병합 | 1:1 관계 테이블 병합 | 1:1 관계를 통합하여 성능 향상 |
|  | 1:M 관계 테이블 병합 | 1:M 관계를 통합하여 성능 향상 |
|   | 슈퍼/서브타입 테이블 병합 | 슈퍼 / 서브 관계를 통합하여 성능 향상 | 
| 테이블 분할 | 수직 분할 | 컬럼단위의 테이블을 디스크 I/O를 분산처리하기 위해 테이블을 1:1로 분리하여 성능 향상 (트랜잭션의 처리되는 유형파악이 선행되어야 함) | 
| | 수평 분할 | 로우 단위로 집중 발생되는 트랜잭션을 분석하여 디스크 I/O 및 데이터 접근의 효율성을 높여 성능을 향상하기 위해 로우 단위로 테이블을 쪼갬 (관계 없음) |
| 테이블 추가 | 중복 테이블 추가 | 다른 업무이거나 서버가 다른 경우 동일한 테이블구조를 중복하여 원격조인을 제거해 성능을 향상시킨다 |
| | 통계 테이블 추가 | SUM, AVG 등을 미리 수행하여 계산해 둬서 조회시 성능을 향상 시킴 |
| | 이력 테이블 추가 | 이력테이블 중에서 마스터 테이블에 존재하는 레코드를 중복하여 이력테이블에 존재하는 방법 |
| | 부분 테이블 추가 | 하나의 테이블을 전체 칼럼 중 자주 이용하는 집중화된 컬럼이 있을 경우, 디스크 I/O 를 줄이기 위해 해당 컬럼들을 모아 놓은 별도의 반정규화된 테이블 생성 |

#### 컬럼 반정규화
| 반정규화 기법 | 내용 |
| :-----: | :------: |
| 중복컬럼추가 | 조인시 성능저하를 예방하기 위해, 중복된 컬럼을 위치시킨다 |
| 파생컬럼추가 | 트랜잭션이 처리되는 시점에 계산에 의해 발생되는 성능저하를 예방하기 위해, 미리 계산하여 컬럼에 보관 | 
| 이력테이블 컬럼 추가 | 대량의 이력데이터 처리시 불특정 일 조회나 최근 값을 조회할 때 나타날 수 있는 성능저하를 예방하기 위해 기능성 컬럼을 추가함 |
| PK에 의한 컬럼 추가 | 복합의미를 갖는 PK를 단일 속성으로 구성했을때 발생됨, PK 안에 데이터가 존재하지만 성능향상을 위해 일반속성으로 포함하는 방법 |
| 응용시스템 오작동을 위한 컬럼 추가 | 업무적으로는 의미가 없으나, 데이터 처리시 오류로 인해 원래 값으로 복구하길 원하는 경우 이전 데이터를 임시적으로 중복보관 하는 방법 |

#### 관계 반정규화
| 반정규화 기법 | 내용 |
| :-----: | :------: |
| 중복 관계 추가 |  여러 경로로 거쳐 조인이 가능하지만, 성능저하를 예방하기 위해 추가적안 관계를 맺는 방법 |

테이블, 컬럼의 반정규화는 데이터 무결성에 영향을 미치지만 , 관계의 정규화는 데이터 무결성을 꺠뜨리지 않고도 성능을 향상시킬 수 있음