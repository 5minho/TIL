### Transaction


테이블 갱신은 보통 INSERT/UPDATE/DELETE 연산으로 수행합니다.
일반적으로 갱신은 하나의 쿼리만으로 구성하지 않고 복수의 쿼리를 연속적으로 수행하는 경우가 대부분입니다.
이렇게 복수의 쿼리를 한 덩어리로 다뤄야 하는 상황이 있습니다.
트랜잭션이랑 이런 복수 쿼리를 한 단위로 묶은 것입니다.

#### InnoDB vs MyISAM

MySQL의 테이블의 종류는 2종류가 있습니다.
* InnoDB : 트랜잭션 구조를 사용할 수 있음
* MyISAM : 트랜잭션 구조를 사용할 수 없음

#### ACID 특성

트랜잭션은 ACID 라고 불리는 4가지 특성으로 정의가 됩니다.
* Atomicity (원자성)
* Consistency (일관성)
* Isolation (고립성)
* Durability (지속성)

##### Atomicity (원자성)
원자성이란 연속적인 데이터 조작이 전부 성공할지, 전부 실패할지 보증하는 것입니다.
예를 들어서 서울에서 부산까지 KTX를 타고 간 후, 일박후 다음날 서울로 돌아오는 경우

1. 서울 -> 부산 좌석 예매
2. 부산에서 숙소 예약
3. 부산 -> 서울 좌석 예매
4. 1 ~ 3의 요금 지불

이러한 절차가 모두 잘 진행이 된다면 트랜잭션에서 1 ~ 4 를 처리할 후에 'COMMIT'을 실행해 처리를 확정합니다. 만약 좌석이 없다든가, 지불할 돈이 없다면 중간에 실패를 할 수 있습니다. 이런 경우네는 'ROLLBACK'을 실행해 1 의 직전 상태까지 되돌아가서 원자성을 보증합니다.


##### Consistency (일관성)

데이터베이스에서는 Table, Column 등에 정합성 제약을 추가할 수 있습니다.
일관성은 연속적인 데이터 조작 전후에 그 상태를 유지하는것을 보장하는 것입니다.

예를 들어서 시스템에서 사용자를 등록할 때 사용자를 식별하기 위해서 사용자 번호를 사용자에게 발급합니다.
이 사용자 번호에 UNIQUE 제약을 설정하면 중복된 사용자 번호를 저장할 수 없습니다.
복수의 사용자가 동시에 사용자 번호를 취득하려는 경우에도 마찬가지 입니다.

##### Isolation (고립성)

고립성이랑 연속적인 데이터 조작을 복수의 사용자가 동시에 실행해도 각각의 처리가 모순없이 실행되는 것을 보증한다는 것입니다. 여기서 모순없이 실행된다는 것은 복수의 사용자가 (복수의 트랜잭션이) 동시가 아닌 순서대로 실행되는 경우와 같은 상태를 얻을 수 있다면 모순없이 실행된다는 것입니다.

예를 들면 빈 방이 10개가 있는 호텔에 예약을 한다고 가정했을때,
1. 방의 개수를 확인하고 (SELECT)
2. 방의 개수에서 1을 뺀 결과를 되돌려 씁니다 (UPDATE)

이 절차를 사용자 A와 B가 동시에 수행한다면 다음과 같은 문제가 있을 수 있습니다.

동시에
A : 빈 방을 확인합니다. (빈 방 : 10개)
B : 빈 방을 확인합니다. (빈 방 : 10개)

동시에
A : 빈 방을 예약합니다. (빈 방 : 9개)
B : 빈 방을 예약합니다. (빈 방 : 9개)

2명이 예약을 했지만 빈 방은 하나 밖에 줄어들지 않았습니다.

이 고립성을 보증하기 위해 데이터베이스에서는 Lock(잠금) 이란 것을 사용합니다.
MySQL은 행 단위로 잠금을 해서 위의 문제를 해결 합니다.

동시에
A : 빈 방을 확인합니다. (빈 방 : 10개)
B : 빈 방을 확인합니다. (빈 방 : 10개)
A : 빈 방을 예약합니다. (빈 방 : 9개) (잠금)
B : 빈 방을 예약합니다. (빈 방 : ?개) <- 잠금이 걸려 아직 실행되지 못했습니다.
(잠금 해제, 빈 방 : 9개)
잠금이 해제되어 B 가 빈 방 예약함  (빈 방 : 8개)

##### Durability (지속성)

지속성은 연속적인 데이터 조작을 완료하면(COMMIT) 사용자가 받는 시점에서 그 조작이 영구적이 되어 그 결과를 잃지 않는 것을 나타냅니다. 데이터베이스, OS의 이상 종료에도 마찬가지 입니다.
MySQL 은 트랜잭션 조작을 하드 디스크에 LOG(로그)로 기록을 하고, 시스템에 이상이 발생하면 그 로그를 사용해서 이상 발생 전의 상태까지 복원하는 것으로 지속성을 보증합니다.
